USE master DROP DATABASE IF EXISTS SPJ

CREATE DATABASE SPJ

/*
DROP TABLE IF EXISTS S
DROP TABLE IF EXISTS P
DROP TABLE IF EXISTS J
DROP TABLE IF EXISTS SPJ
*/

GO

USE SPJ CREATE TABLE S			 /* 供应商表*/
 (	
 SNO CHAR(4) PRIMARY KEY,        /* 列级完整性约束条件,SNO是主码*/                  
 SNAME CHAR(20) NOT NULL,        /* SNAME不为空*/
 STATUS SMALLINT,
 CITY CHAR(20)
 ); 

CREATE TABLE P					 /* 零件表*/
 (	
 PNO CHAR(4) PRIMARY KEY,        /* 列级完整性约束条件,PNO是主码*/                  
 PNAME CHAR(20) NOT NULL,        /* PNAME不为空*/
 COLOR CHAR(10),
 WEIGHT SMALLINT
 ); 

CREATE TABLE J					 /* 工程项目表*/
 (	
 JNO CHAR(4) PRIMARY KEY,        /* 列级完整性约束条件,JNO是主码*/                  
 JNAME CHAR(20) NOT NULL,        /* JNAME不为空*/
 CITY CHAR(20)
 ); 

CREATE TABLE SPJ				 /* 供应情况表*/
 (	
 SNO CHAR(4) NOT NULL,
 PNO CHAR(4) NOT NULL,
 JNO CHAR(4) NOT NULL,
 QTY INT
 ); 

ALTER TABLE SPJ
   ADD CONSTRAINT FK_SPJ_S_SNO				  --添加约束 名称 FK_含外键的表_被参照表_含外键的表中的属性
       FOREIGN KEY (SNO) REFERENCES S(SNO)    --外键约束，外键列名，被引用列名

ALTER TABLE SPJ
   ADD CONSTRAINT FK_SPJ_P_PNO				  --添加约束 名称 FK_含外键的表_被参照表_含外键的表中的属性
       FOREIGN KEY (PNO) REFERENCES P(PNO)    --外键约束，外键列名，被引用列名

ALTER TABLE SPJ
   ADD CONSTRAINT FK_SPJ_J_JNO				  --添加约束 名称 FK_含外键的表_被参照表_含外键的表中的属性
       FOREIGN KEY (JNO) REFERENCES J(JNO)    --外键约束，外键列名，被引用列名

ALTER TABLE SPJ
	ADD CONSTRAINT PK_SPJ_SNOPNOJNO PRIMARY KEY nonclustered
	(SNO,
	 PNO,
	 JNO)

INSERT  INTO  S (SNO,SNAME,STATUS,CITY) VALUES ('S1','精益',20,'天津');
INSERT  INTO  S (SNO,SNAME,STATUS,CITY) VALUES ('S2','盛锡',10,'北京');
INSERT  INTO  S (SNO,SNAME,STATUS,CITY) VALUES ('S3','东方红',30,'北京');
INSERT  INTO  S (SNO,SNAME,STATUS,CITY) VALUES ('S4','丰泰盛',20,'天津');
INSERT  INTO  S (SNO,SNAME,STATUS,CITY) VALUES ('S5','为民',30,'上海');

SELECT * FROM S

INSERT  INTO  P (PNO,PNAME,COLOR,WEIGHT) VALUES ('P1','螺母','红',12);
INSERT  INTO  P (PNO,PNAME,COLOR,WEIGHT) VALUES ('P2','螺栓','绿',17);
INSERT  INTO  P (PNO,PNAME,COLOR,WEIGHT) VALUES ('P3','螺丝刀','蓝',14);
INSERT  INTO  P (PNO,PNAME,COLOR,WEIGHT) VALUES ('P4','螺丝刀','红',14);
INSERT  INTO  P (PNO,PNAME,COLOR,WEIGHT) VALUES ('P5','凸轮','蓝',40);
INSERT  INTO  P (PNO,PNAME,COLOR,WEIGHT) VALUES ('P6','齿轮','红',30);

SELECT * FROM P

INSERT  INTO  J (JNO,JNAME,CITY) VALUES ('J1','三建','北京');
INSERT  INTO  J (JNO,JNAME,CITY) VALUES ('J2','一汽','长春');
INSERT  INTO  J (JNO,JNAME,CITY) VALUES ('J3','弹簧厂','天津');
INSERT  INTO  J (JNO,JNAME,CITY) VALUES ('J4','造船厂','天津');
INSERT  INTO  J (JNO,JNAME,CITY) VALUES ('J5','机车厂','唐山');
INSERT  INTO  J (JNO,JNAME,CITY) VALUES ('J6','无线电厂','常州');
INSERT  INTO  J (JNO,JNAME,CITY) VALUES ('J7','半导体厂','南京');

SELECT * FROM J

INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S1','P1','J1',200);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S1','P1','J3',100);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S1','P1','J4',700);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S1','P2','J2',100);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S2','P3','J1',400);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S2','P3','J2',200);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S2','P3','J4',500);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S2','P3','J5',400);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S2','P5','J1',400);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S2','P5','J2',100);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S3','P1','J1',200);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S3','P3','J1',200);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S4','P5','J1',100);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S4','P6','J3',300);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S4','P6','J4',200);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S5','P2','J4',100);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S5','P3','J1',200);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S5','P6','J2',200);
INSERT  INTO  SPJ (SNO,PNO,JNO,QTY) VALUES ('S5','P6','J4',500);

SELECT * FROM SPJ